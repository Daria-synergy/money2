{% extends 'index.html' %}
{% block content %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const filterBtns = document.querySelectorAll('.filter-btn');

    filterBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
            const filterValue = this.dataset.filter;

            // –ê–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');

            // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –í–°–ï –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∏ "all"
            document.querySelectorAll('.savings-card').forEach(card => {
                if (filterValue === 'all') {
                    card.classList.remove('filtered');
                } else {
                    const category = card.querySelector('.card-category').textContent.trim();
                    if (category === filterValue) {
                        card.classList.remove('filtered');
                    } else {
                        card.classList.add('filtered');
                    }
                }
            });
        });
    });
});
</script>
<!-- –ò–∫–æ–Ω–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –ø—Ä–µ–∂–Ω–µ–º –º–µ—Å—Ç–µ -->
<div class="icon-container">
    <a href="/create">
        <img class="img1" src="/static/img/plus.png" alt="–°–æ–∑–¥–∞—Ç—å">
    </a>
    <a href="/logout">
        <img class="img1" src="/static/img/exit.png" alt="–í—ã—Ö–æ–¥">
    </a>
    <a href="#" class="theme-toggle">
        <img class="img1" src="/static/img/set.png" alt="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
    </a>
</div>

<!-- –ì–ª–∞–≤–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
<h1 class="main-title">–ú–æ–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è</h1>

<!-- Flash —Å–æ–æ–±—â–µ–Ω–∏—è -->
{% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for message in messages %}
            <div class="alert">{{ message }}</div>
        {% endfor %}
    {% endif %}
{% endwith %}

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ü–µ–ª–µ–π -->
<div class="stats-overview">
    <div class="stat-card completed">
        <div class="stat-number">{{ n.filter_by(status='–¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞').count() }}</div>
        <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏</div>
    </div>
    <div class="stat-card in-progress">
        <div class="stat-number">{{ n.filter_by(status='–Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞').count() }}</div>
        <div class="stat-label">–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏</div>
    </div>
</div>

<!-- –§–ò–õ–¨–¢–†–´ –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú -->
<div class="filters-section">
    <div class="filters-container">
        <button class="filter-btn active" data-filter="all">–í—Å–µ —Ü–µ–ª–∏</button>
        <button class="filter-btn" data-filter="–•–æ–±–±–∏">üß© –•–æ–±–±–∏</button>
        <button class="filter-btn" data-filter="–ó–¥–æ—Ä–æ–≤—å–µ">üíâ –ó–¥–æ—Ä–æ–≤—å–µ</button>
        <button class="filter-btn" data-filter="–†–∞–±–æ—Ç–∞">üíº –†–∞–±–æ—Ç–∞</button>
        <button class="filter-btn" data-filter="–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ">üéìÔ∏è –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</button>
        <button class="filter-btn" data-filter="–ü—Ä–æ—á–µ–µ">üéÅ –ü—Ä–æ—á–µ–µ</button>
    </div>
</div>

<!-- –õ–∏—á–Ω—ã–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è -->
<div class="savings-section">
    <div class="section-header">
        <h2 class="section-title">–õ–∏—á–Ω—ã–µ —Ü–µ–ª–∏</h2>
        <div class="section-badge personal">–¢–æ–ª—å–∫–æ –¥–ª—è –º–µ–Ω—è</div>
    </div>
    <div class="savings-grid">
        {% for comment in n %}
            <a href="/card/{{ comment.id }}" class="savings-card personal-card">
                {% if comment.cat == "–•–æ–±–±–∏" %}
                <div class="card-icon personal-icon">üß©</div>
                {% elif comment.cat == "–ó–¥–æ—Ä–æ–≤—å–µ" %}
                <div class="card-icon personal-icon">üíâ</div>
                {% elif comment.cat == "–†–∞–±–æ—Ç–∞" %}
                <div class="card-icon personal-icon">üíº</div>
                {% elif comment.cat == "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ" %}
                <div class="card-icon personal-icon">üéì</div>
                {% elif comment.cat == "–ü—Ä–æ—á–µ–µ" %}
                <div class="card-icon personal-icon">üéÅ</div>
                {% endif %}
                <div class="card-header">
                    <div class="card-title">{{ comment.title }}</div>
                    <div class="card-category">{{ comment.cat }}</div>
                </div>
                <div class="card-progress">
                    <div class="progress-fill" style="width: {{ (comment.balance * 100 // comment.sum_) if comment.sum_ > 0 else 0 }}%"></div>
                </div>
                <div class="card-stats">
                    <div class="progress-percent">{{ (comment.balance * 100 // comment.sum_) if comment.sum_ > 0 else 0 }}%</div>
                    <div class="balance-info">
                        {{ comment.balance }} ‚ÇΩ / {{ comment.sum_ }} ‚ÇΩ
                    </div>
                </div>
                <div class="card-status {{ 'completed' if comment.status == '–¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞' else 'active' }}">
                    {{ comment.status }}
                </div>
            </a>
        {% endfor %}
    </div>
</div>

<!-- –°–æ–≤–º–µ—Å—Ç–Ω—ã–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è -->
<div class="savings-section joint">
    <div class="section-header">
        <h2 class="section-title">–°–æ–≤–º–µ—Å—Ç–Ω—ã–µ —Ü–µ–ª–∏</h2>
        <div class="section-badge joint">–° –¥—Ä—É–∑—å—è–º–∏</div>
    </div>
    <div class="savings-grid">
        {% for comment in n1 %}
            {% if comment.users != None %}
                {% if session.user in comment.users %}
                    <a href="/card/{{ comment.id }}" class="savings-card joint-card">
                        {% if comment.cat == "–•–æ–±–±–∏" %}
                        <div class="card-icon joint-icon">üß©</div>
                        {% elif comment.cat == "–ó–¥–æ—Ä–æ–≤—å–µ" %}
                        <div class="card-icon joint-icon">üíâ</div>
                        {% elif comment.cat == "–†–∞–±–æ—Ç–∞" %}
                        <div class="card-icon joint-icon">üíº</div>
                        {% elif comment.cat == "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ" %}
                        <div class="card-icon joint-icon">üéì</div>
                        {% elif comment.cat == "–ü—Ä–æ—á–µ–µ" %}
                        <div class="card-icon joint-icon">üéÅ</div>
                        {% endif %}
                        <div class="card-header">
                            <div class="card-title">{{ comment.title }}</div>
                            <div class="card-category">{{ comment.cat }}</div>
                        </div>
                        <div class="card-progress">
                            <div class="progress-fill" style="width: {{ (comment.balance * 100 // comment.sum_) if comment.sum_ > 0 else 0 }}%"></div>
                        </div>
                        <div class="card-stats">
                            <div class="progress-percent">{{ (comment.balance * 100 // comment.sum_) if comment.sum_ > 0 else 0 }}%</div>
                            <div class="balance-info">
                                {{ comment.balance }} ‚ÇΩ / {{ comment.sum_ }} ‚ÇΩ
                            </div>
                        </div>
                        <div class="card-status {{ 'completed' if comment.status == '–¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞' else 'active' }}">
                            {{ comment.status }}
                        </div>
                    </a>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endblock %}